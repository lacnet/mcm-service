function LoadMozillaCompatLayer(a){a.__lastElt=window.document;a.__blurTimeout=0;a.HTMLDocument.prototype.parentWindow=a;function h(){var a=document.documentElement;a.addEventListener("focus",e,true);a.addEventListener("mousedown",c,true);window.addEventListener("focus",f,true);window.addEventListener("blur",g,true)}window.addEventListener("load",h,false);function c(c){if(a.__lastElt!=c.srcElement)switch(c.srcElement.tagName){case "INPUT":case "A":case "BUTTON":case "SELECT":case "TEXTAREA":break;default:setTimeout(function(){b("focus",c.srcElement)},0)}}function f(){if(a.__blurTimeout!=0){clearTimeout(a.__blurTimeout);a.__blurTimeout=0}if(a.__userLeftBrowser){a.__userLeftBrowser=false;b("focusin",a.__lastElt)}}function g(){if(a.__blurTimeout==0)a.__blurTimeout=setTimeout(d,100)}function d(){var c=a.__lastElt;a.__lastElt=null;b("focusout",c);a.__lastElt=c;a.__userLeftBrowser=true;a.__blurTimeout==0}function e(c){if(a.__lastElt){var d=a.__lastElt;a.__lastElt=c.srcElement;b("focusout",d);a.__lastElt=d}b("focusin",c.srcElement);a.__lastElt=c.srcElement}function b(b,c){var a=document.createEvent("Event");a.initEvent(b,true,false);c.dispatchEvent(a)}a.HTMLElement.prototype.setCapture=function j(){var c=this;this.capture=["click","mousedown","mouseup","mousemove","mouseover","mouseout"];this._capture=function(a){if(a.isCapturing)return;var b=document.createEvent("MouseEvents");b.initMouseEvent(a.type,a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget);b.isCapturing=true;c.dispatchEvent(b)};for(var b=0;b<this.capture.length;b++)a.addEventListener(this.capture[b],this._capture,true)};a.HTMLElement.prototype.releaseCapture=function i(){for(var b=0;b<this.capture.length;b++)a.removeEventListener(this.capture[b],this._capture,true);this._capture=null};a.HTMLElement.prototype.setActive=function k(){this.focus()}}if(window.navigator.userAgent.indexOf("Safari")<0)LoadMozillaCompatLayer(window);var gPlayFlash=-1,gSoundOn=true;function detectFlash(){gPlayFlash=0;if(navigator.plugins&&navigator.plugins.length){var a=navigator.plugins["Shockwave Flash"];if(a)if(a.description){var b=a.description,d=b.charAt(b.indexOf(".")-1);if(d>=4)gPlayFlash=1}}else if(navigator.mimeTypes&&navigator.mimeTypes.length){var c=navigator.mimeTypes["application/x-shockwave-flash"];if(c&&c.enabledPlugin)gPlayFlash=1}}function canPlayFlash(){if(gPlayFlash<0)detectFlash();return gPlayFlash==1}function initializeFlashUI_UpdateTitle(){window.document.title=gStrings.PageTitleServiceName}function initializeFlashUI(){if(canPlayFlash()){var a=document.getElementById("flashSoundDiv");if(a!=null)if(a.innerHTML==""||a.innerHTML==null){var b=getSoundDirectory(),c='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=4,0,0,0" id="type" width="1" height="1" align="middle"><param name="allowScriptAccess" value="sameDomain" /><param name="movie" value="'+b+'type.swf" /><param name="quality" value="high" /><param name="bgcolor" value="#ffffff" /><embed src="'+b+'type.swf" quality="high" bgcolor="#ffffff" width="1" height="1" swLiveConnect=true id="type" name="type" align="middle" allowScriptAccess="sameDomain" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" /></object><object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=4,0,0,0" id="nudge" width="1" height="1" align="middle"><param name="allowScriptAccess" value="sameDomain" /><param name="movie" value="'+b+'nudge.swf" /><param name="quality" value="high" /><param name="bgcolor" value="#ffffff" /><embed src="'+b+'nudge1.swf" quality="high" bgcolor="#ffffff" width="1" height="1" swLiveConnect=true id="nudge" name="nudge" align="middle" allowScriptAccess="sameDomain" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" /></object>';a.innerHTML=c;if(isIE())setTimeout(initializeFlashUI_UpdateTitle,500)}}}function createTimer(c,d,e){var a=0;a=setTimeout(b,d);function b(){c(e,a)}return a}function clearSoundSource(a){if(null==a)return;var b=document.getElementById(a);if(null==b)return;b.src=""}function getSWF(a){if(document[a].length!=undefined)return document[a][1];return document[a]}function playFlashSound(b){try{var a=getSWF(b);a.Rewind();a.Play()}catch(c){}}function playBGSound(b){try{var a=document.getElementById("soundPlayIE");if(null!=a)if(!a.src){a.src=b;createTimer(clearSoundSource,1e3,"soundPlayIE")}}catch(c){}}function getSoundDirectory(){return getImage("sounds/",true)}function playSound(a,b){if(gSoundOn&&!b)if(canPlayFlash())playFlashSound(a);else if(isIE()){var c=getSoundDirectory()+a+".wav";playBGSound(c)}}Array.__typeName="Array";Array.prototype.add=function Array$add(a){this[this.length]=a};function $(a){return document.getElementById(a)}function endsWith(b,a){if(!a.length)return true;if(a.length>b.length)return false;return b.substr(b.length-a.length)==a}var userAgent=window.navigator.userAgent,gIsIE=userAgent.indexOf("MSIE")>=0;function isIE(){return gIsIE}var gIsIE6=userAgent.indexOf("MSIE 6")>=0;function isIE6(){return gIsIE6}var gIsIE7=userAgent.indexOf("MSIE 7")>=0;function isIE7(){return gIsIE7}var gIsFF=userAgent.indexOf("Firefox/")>=0;function isFF(){return gIsFF}var gCurrentEm2PxOffset=-1,gcTextSizeTooSmallLimit=9e3,gFocus=null,gSharedInterval=null;function suppressOnceOpenConversationsWarning(){}function EM2PX_onresize(){gPopoutWindow.resizeOnEmChange()}function window_onbeforeunload(){gPopoutWindow.onWindowBeforeUnload()}function window_onunload(){if(gPopoutWindow){gPopoutWindow.onWindowUnload();window.detachEvent("onunload",window_onunload);gPopoutWindow=null}}function window_onresize(){gPopoutWindow.onWindowResize()}function document_onclick(){gPopoutWindow.resetIdleTime()}function document_onkeydown(){gPopoutWindow.onDocumentKeyDown()}function conversationWindow_resize(){if(gPopoutWindow)gPopoutWindow.onConversationWindowResize()}function UINavigateTo(a){if(gPopoutWindow)gPopoutWindow.navigateTo(a)}var PopoutWindow=function PopoutWindow$(){};PopoutWindow.prototype={_owner:null,_webIM:null,_chatManager:null,_conversationWindow:null,_anchors:[],_resizeOnEmIntervalId:null,_resizeTimeoutID:0,navigateTo:function PopoutWindow$navigateTo(a){if(this._owner&&this._owner.gImUI)this._owner.gImUI.navigateTo(a)},resizeOnEmChange:function PopoutWindow$resizeOnEmChange(){var a=$("EM2PX").offsetWidth;if(gCurrentEm2PxOffset!=a){gCurrentEm2PxOffset=a;if(gCurrentEm2PxOffset<gcTextSizeTooSmallLimit)document.body.className=document.body.className.replace(/textsizeokay/g,"textsizetoosmall");else document.body.className=document.body.className.replace(/textsizetoosmall/g,"textsizeokay");this.onWindowResize()}},closeout:function PopoutWindow$closeout(c){if(this._conversationWindow!=null){var b=this._conversationWindow;this._conversationWindow=null;this._chatManager.closeConversation(b.getConversationId(),!c);window.detachEvent("onresize",window_onresize);window.detachEvent("onbeforeunload",window_onbeforeunload);window.document.detachEvent("onclick",document_onclick);window.document.detachEvent("onkeydown",document_onkeydown);window.clearInterval(this._resizeOnEmIntervalId);if(isIE())$("EM2PX").detachEvent("onresize",EM2PX_onresize);b.dispose();for(var a=0;a<this._anchors.length;a++){this._anchors[a].dispose();this._anchors[a]=null}delete this._anchors;this._anchors=null;this._webIM=null;this._chatManager=null;window.Debug=null;this._owner=null}},resetIdleTime:function PopoutWindow$resetIdleTime(){if(this._conversationWindow)this._conversationWindow.resetIdleTime()},onWindowBeforeUnload:function PopoutWindow$onWindowBeforeUnload(){if(this._conversationWindow&&this._conversationWindow.isGroup())window.event.returnValue=this._owner.gStrings.Group_CloseDialog_Text},onWindowUnload:function PopoutWindow$onWindowUnload(){this.closeout(false)},onConversationWindowResize:function PopoutWindow$onConversationWindowResize(){if(this._conversationWindow)try{this._conversationWindow.onResize()}catch(a){}},onWindowResize:function PopoutWindow$onWindowResize(){this.resetIdleTime();if(isIE7()){var b=gHtml.offsetWidth/gBody.offsetWidth;gAppDivStyle.height=gHtml.offsetHeight*b+"px";gAppDivStyle.width=gHtml.offsetWidth*b+"px"}if(this._owner)for(var a=0;a<this._anchors.length;a++)this._anchors[a].resize();if(this._resizeTimeoutID!=0)clearTimeout(this._resizeTimeoutID);this._resizeTimeoutID=setTimeout(conversationWindow_resize,10)},onDocumentKeyDown:function PopoutWindow$onDocumentKeyDown(a){this.resetIdleTime();a=a?a:window.event;if(a.keyCode==116||a.keyCode==115){a.returnValue=false;a.cancelBubble=true;if(!isIE()){a.stopPropagation();a.preventDefault()}return false}return true},setupAnchor:function PopoutWindow$setupAnchor(e,d,c){var b=$(d),a=null;if(b!=null)a=e.newAnchor(b,c,window);return a},setupAnchors:function PopoutWindow$setupAnchors(){if(isIE6()){var a=this._owner.gCWUtilities;this._anchors.push(this.setupAnchor(a,"PopoutBody",null));this._anchors.push(this.setupAnchor(a,"Popoutcontainer",null));this._anchors.push(this.setupAnchor(a,"conv_cw",null))}},main:function PopoutWindow$main(){if(window.opener)this._owner=window.opener;else return;try{this._webIM=this._owner.gWebIM;this._chatManager=this._webIM.get_chatManager();window.Debug=this._owner.Debug}catch(b){return}var a=this._chatManager.getIdForWindowName(window.name);this._chatManager.popOutComplete(window.name,a)},selectConversation:function PopoutWindow$selectConversation(){if(this._conversationWindow)this._conversationWindow.selectConversation()},setupConversation:function PopoutWindow$setupConversation(b){var a=document.getElementById("conv_cw");this._conversationWindow=this._owner.gCWUtilities.createWindowForConversation(a,b,true,window);if(!isIE())this._resizeOnEmIntervalId=window.setInterval(EM2PX_onresize,500);if(isIE())$("EM2PX").attachEvent("onresize",EM2PX_onresize);this.setupAnchors();window.attachEvent("onbeforeunload",window_onbeforeunload);window.attachEvent("onunload",window_onunload);window.attachEvent("onresize",window_onresize);window.document.attachEvent("onclick",document_onclick);window.document.attachEvent("onkeydown",document_onkeydown);gAppDivStyle=$("AppContainer").style;gHtml=document.getElementsByTagName("HTML")[0];gBody=document.getElementsByTagName("BODY")[0];gSharedInterval=this._owner.MailIM.SharedInterval.Create(window,1e3);gFocus=this._owner.MailIM.WindowFocus.Create(window);this._conversationWindow.setPopOutImageElements($("youImg"),$("youImgPNG"),$("meImg"),$("networkIconImg"));a=null;this.onWindowResize();this._conversationWindow.readyToConverse();this.selectConversation()}};var gPopoutWindow=new PopoutWindow