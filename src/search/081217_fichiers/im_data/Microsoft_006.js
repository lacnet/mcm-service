// Copyright (c) Microsoft Corporation. All rights reserved.

Type.createNamespace('MSE');MSE._E$0=function(){};MSE._E$0.prototype = {$0:0,$1:1,$2:2,$3:3}
MSE._E$0.createEnum('MSE._E$0',false);MSE._E$1=function(){};MSE._E$1.prototype = {$0:0,$1:1,$2:2}
MSE._E$1.createEnum('MSE._E$1',false);MSE._E$4=function(profile,onCompleted){MSE._E$4.constructBase(this,[profile]);this.$1B=onCompleted;this.$1C=0;}
MSE._E$4.prototype={$1B:null,$1C:0,$1D:null,$E:function(){this.$11();},$10:function(){this.$1B.invoke(this.get_$B());MSE._E$4.callBase(this, '$10');},$12:function(){switch(this.$1C){case 0:this.$17(2,this.get_$A().get_$7()+MSE._E$3.$1,this.$C(),MSE._E$4.$18,Delegate.create(this,this.$1E));break;case 1:this.$17(2,this.get_$A().get_$7()+MSE._E$3.$0,this.$C(),MSE._E$4.$19,Delegate.create(this,this.$1E));break;case 2:if(!String.isNullOrEmpty(this.$1D)){var $0={};$0['Content-Type']='text/xml; charset=utf-8';$0['SOAPAction']='\"http://www.msn.com/webservices/storage/w10/ShareItem\"';this.$17(1,this.get_$A().get_$7()+MSE._E$3.$2,$0,String.format(MSE._E$4.$1A,this.get_$A().get_$8().partnerId,this.$1D),Delegate.create(this,this.$1E));}else{this.set_$B(1);this.$F();}break;case 3:this.set_$B(0);this.$F();break;}},$1E:function($p0){switch($p0.get_status()){case 200:case 201:case 204:var $0=$p0.getResponseHeader('X-Resource-Id');if(!String.isNullOrEmpty($0)){this.$1D=$0;}this.$1C++;this.$11();break;case 301:this.get_$A().$9($p0.getResponseHeader('Location'));this.$11();break;case 0:case 302:case 403:this.$13('CreateProfile');break;default:this.$14('CreateProfile',$p0);this.set_$B(1);this.$F();break;}}}
MSE._E$3=function(profile){this.$3=profile;}
MSE._E$3.prototype={$3:null,$4:false,$5:false,$6:false,$7:0,$8:false,$9:null,get_$A:function(){return this.$3;},get_$B:function(){return this.$7;},set_$B:function($p0){this.$7=$p0;return $p0;},$C:function(){var $0={};$0['Application']=this.$3.get_$8().partnerId;$0['Content-Type']='application/web3s+xml';$0['Cache-Control']='no-cache';$0['Pragma']='No-Cache';return $0;},$D:function(){this.$4=true;this.$E();},$F:function(){if(!this.$6){this.$3.$C(this);this.$6=true;this.$10();}},$10:function(){if(this.$16){this.$16.invoke(this,EventArgs.Empty);}},$11:function(){this.$12();},$13:function($p0){MSCo.LogHelper.loggerError(this.get_$A().get_logger(),$p0,'Authentication failed.');this.$3.$A(new MC.AuthenticationFailedEventArgs(this));},$14:function($p0,$p1){MSCo.LogHelper.loggerError(this.get_$A().get_logger(),$p0,String.format('Error:{0} Content:{1}',$p1.get_status(),$p1.get_statusText()));},add_$15:function($p0){this.$16=Delegate.combine(this.$16,$p0);},remove_$15:function($p0){this.$16=Delegate.remove(this.$16,$p0);},$16:null,retry:function(){if(this.$8){this.$7=1;this.$F();return;}this.$8=true;this.$11();},fail:function(){this.set_$B(2);this.$F();},abort:function(){var $0=null;$0=this.$9;this.$5=true;if($0){$0.abort();}},$17:function($p0,$p1,$p2,$p3,$p4){var $0=null;if(!this.$5){$0=new MSCo.HttpRequest($p0,$p1,$p3,$p2,$p4);this.$9=$0;}if($0){$0.execute();}}}
MSE._E$6=function(profile,presence,onCompleted){MSE._E$6.constructBase(this,[profile]);this.$18=presence;this.$19=onCompleted;}
MSE._E$6.prototype={$18:null,$19:null,$E:function(){this.$11();},$10:function(){if(this.$19){var $0=0;if(this.get_$B()){$0=1;}this.$19.invoke($0);}MSE._E$6.callBase(this, '$10');},$12:function(){var $0=this.$C();$0['Depth']='1';this.$17(0,this.get_$A().get_$7()+MSE._E$3.$0,$0,null,Delegate.create(this,this.$1A));},$1A:function($p0){switch($p0.get_status()){case 200:this.$1D($p0.get_responseXml());break;case 301:this.get_$A().$9($p0.getResponseHeader('Location'));this.$11();break;case 0:case 302:case 403:this.$13('Synchronize');break;case 404:this.get_$A().$B(new MSE._E$4(this.get_$A(),Delegate.create(this,this.$1C)));break;default:this.$14('Synchronize',$p0);this.set_$B(1);this.$F();break;}},$1B:function($p0){this.set_$B((($p0===1)?1:0));this.$F();},$1C:function($p0){this.set_$B($p0);if(this.get_$B()){this.$F();}else{if(!String.isNullOrEmpty(this.$18.displayName)||!String.isNullOrEmpty(this.$18.personalMessage)){this.get_$A().$B(new MSE._E$5(this.get_$A(),this.$18.displayName,this.$18.personalMessage,Delegate.create(this,this.$1B)));}else{this.$F();}}},$1D:function($p0){var $0=$p0.selectSingleNode('/ExpressionProfile/DisplayName');var $1=$p0.selectSingleNode('/ExpressionProfile/PersonalStatus');var $2=((!$0)?String.Empty:MSCo.XmlHelper.xmlNodeValue($0));if($2.indexOf('&#')>=0){$2=String.Empty;}var $3=((!$1)?String.Empty:MSCo.XmlHelper.xmlNodeValue($1));if(String.isNullOrEmpty(this.$18.displayName)){this.$18.displayName=$2;}if(String.isNullOrEmpty(this.$18.personalMessage)){this.$18.personalMessage=$3;}var $4=$p0.selectSingleNode('/ExpressionProfile/Items/Photo/DocumentStreams/PhotoStream[DocumentStreamType=\'UserTileStatic\']/PreAuthURL');if($4){this.$18.displayPictureUrl=MSCo.XmlHelper.xmlNodeValue($4);}var $5=($2!==this.$18.displayName);var $6=($3!==this.$18.personalMessage);if($5||$6){this.get_$A().$B(new MSE._E$5(this.get_$A(),(($5)?this.$18.displayName:null),(($6)?this.$18.personalMessage:null),Delegate.create(this,this.$1B)));}else{this.set_$B(0);this.$F();}}}
MSE._E$5=function(profile,displayName,personalMessage,onCompleted){MSE._E$5.constructBase(this,[profile]);this.$18=displayName;this.$19=personalMessage;this.$1A=onCompleted;}
MSE._E$5.prototype={$18:null,$19:null,$1A:null,$E:function(){if(!MSCo.StringHelper.isNull(this.$18)||!MSCo.StringHelper.isNull(this.$19)){this.$11();}else{this.set_$B(0);this.$F();}},$10:function(){var $0=0;if(this.get_$B()){$0=1;}this.$1A.invoke($0);MSE._E$5.callBase(this, '$10');},$12:function(){var $0=new StringBuilder();$0.append('<ExpressionProfile>');if(!MSCo.StringHelper.isNull(this.$18)){$0.append('<DisplayName>');$0.append(MSCo.XmlHelper.xmlEscape(this.$18));$0.append('</DisplayName>');}if(!MSCo.StringHelper.isNull(this.$19)){$0.append('<PersonalStatus>');$0.append(MSCo.XmlHelper.xmlEscape(this.$19));$0.append('</PersonalStatus>');}$0.append('</ExpressionProfile>');this.$17(2,this.get_$A().get_$7()+MSE._E$3.$0,this.$C(),$0.toString(),Delegate.create(this,this.$1B));},$1B:function($p0){switch($p0.get_status()){case 200:case 204:this.set_$B(0);this.$F();break;case 301:this.get_$A().$9($p0.getResponseHeader('Location'));this.$11();break;case 0:case 302:case 403:this.$13('UpdateProfile');break;default:this.$14('UpdateProfile',$p0);this.set_$B(1);this.$F();break;}}}
MSE.ExpressionProfile=function(identity){this.$0=identity;this.$4=new MSCo.AbortableCollection();this.$2=MC.$create_ExpressionProfileConfigurationInfo();this.$3=this.$2.hostName;}
MSE.ExpressionProfile.prototype={$0:null,$1:null,$2:null,$3:null,$4:null,synchronize:function(presence,onCompleted){this.$B(new MSE._E$6(this,presence,onCompleted));},update:function(presence,onCompleted){this.$B(new MSE._E$5(this,presence.displayName,presence.personalMessage,onCompleted));},add_authenticationFailed:function(value){this.$5=Delegate.combine(this.$5,value);},remove_authenticationFailed:function(value){this.$5=Delegate.remove(this.$5,value);},$5:null,get_logger:function(){return this.$1;},set_logger:function(value){if(value){value.set_module('ExpressionProfile');value.set_context(this.$0.liveId);}this.$1=value;return value;},get_$6:function(){return this.$0;},get_$7:function(){return this.$3;},get_$8:function(){return this.$2;},updateConfiguration:function(configuration){this.$2=configuration;this.$3='http://'+this.$2.hostName;},$9:function($p0){this.$3=MSCo.HttpHelper.extractScheme($p0)+MSCo.HttpHelper.extractHost($p0);},$A:function($p0){if(this.$5){this.$5.invoke(this,$p0);}},$B:function($p0){this.$4.add($p0);$p0.$D();},$C:function($p0){this.$4.remove($p0);},abort:function(){this.$4.abort();}}
MSE._E$3.createClass('MSE._E$3',null,MC.IAuthenticatedCommand,MC.IAbortable);MSE._E$4.createClass('MSE._E$4',MSE._E$3,MC.IAbortable);MSE._E$6.createClass('MSE._E$6',MSE._E$3);MSE._E$5.createClass('MSE._E$5',MSE._E$3,MC.IAuthenticatedCommand,MC.IAbortable);MSE.ExpressionProfile.createClass('MSE.ExpressionProfile',null,MC.IExpressionProfile);MSE._E$4.$18='<Profile>\r\n                <RoleDefinitionName>ProfileDefault</RoleDefinitionName>\r\n                <Name></Name>\r\n              </Profile>';MSE._E$4.$19='<ExpressionProfile>\r\n                <RoleDefinitionName>ExpressionProfileDefault</RoleDefinitionName>\r\n                <Name>Messenger Roaming Profile</Name>\r\n                <FreeText> </FreeText>\r\n             </ExpressionProfile>';MSE._E$4.$1A='<?xml version=\'1.0\' encoding=\'utf-8\'?>\r\n            <soap:Envelope xmlns:soap=\'http://schemas.xmlsoap.org/soap/envelope/\' xmlns:xsi=\'http://www.w3.org/2001/XMLSchema-instance\' xmlns:xsd=\'http://www.w3.org/2001/XMLSchema\'>\r\n                <soap:Header>\r\n                    <StorageApplicationHeader xmlns=\'http://www.msn.com/webservices/storage/w10\'>\r\n                        <ApplicationID>{0}</ApplicationID>\r\n                        <Scenario>RoamingSeed</Scenario>\r\n                    </StorageApplicationHeader>\r\n                    <StorageUserHeader xmlns=\'http://www.msn.com/webservices/storage/w10\'>\r\n                        <IsAdmin>false</IsAdmin>\r\n                    </StorageUserHeader>\r\n                </soap:Header>\r\n                <soap:Body>\r\n                    <ShareItem xmlns=\'http://www.msn.com/webservices/storage/w10\'>\r\n                        <resourceID>{1}</resourceID>\r\n                        <displayName>Messenger Roaming Identity</displayName>\r\n                    </ShareItem>\r\n                </soap:Body>\r\n            </soap:Envelope>';MSE._E$3.$0='/MyData/MyProfile/ExpressionProfile';MSE._E$3.$1='/MyData/MyProfile';MSE._E$3.$2='/storageservice/SchematizedStore.asmx';
// ---- Do not remove this footer ----
// Generated using Script# v0.5.1.0 (http://projects.nikhilk.net)
// -----------------------------------
